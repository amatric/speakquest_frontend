<!-- pages/challenge/challenge.wxml -->
<view class="challenge-page">
  <!-- æ ‡é¢˜ -->
  <view class="header">
    <text class="title-line1">PICK A</text>
    <text class="title-line2">CHALLENGE</text>
  </view>

  <!-- æŒ‘æˆ˜å¡ç‰‡åˆ—è¡¨ -->
  <scroll-view class="challenge-list" scroll-y="true" show-scrollbar="{{false}}" enhanced="{{true}}">
    <view 
      class="challenge-card" 
      wx:for="{{challenges}}" 
      wx:key="id"
      bindtap="onCardTap"
      data-challenge="{{item}}"
      style="background: {{item.bgColor || '#A0D2F5'}};"
    >
      <!-- NPC å›¾ç‰‡åŒºåŸŸ -->
      <view class="card-image-area">
        <image class="npc-avatar" src="{{item.npcAvatar}}" mode="aspectFit"></image>
        <view class="dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
      </view>

      <!-- å¡ç‰‡ä¿¡æ¯ -->
      <view class="card-info">
        <view class="card-header">
          <text class="card-title">{{item.title}}</text>
          <view class="difficulty-tag difficulty-{{item.difficulty}}">
            {{item.difficultyText}}
          </view>
        </view>
        
        <view class="card-role">
          <text>{{item.npcRole}}</text>
        </view>

        <text class="card-desc">{{item.description}}</text>

        <!-- ç®­å¤´æŒ‰é’® -->
        <view class="arrow-btn">
          <text>â†’</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- ä»»åŠ¡è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showModal}}" bindtap="closeModal">
    <view class="modal-content" catchtap="preventClose">
      <!-- å…³é—­æŒ‰é’® -->
      <view class="modal-close-btn" bindtap="closeModal">
        <text>Ã—</text>
      </view>

      <!-- NPC å›¾ç‰‡åŒºåŸŸ -->
      <view class="modal-npc-area" style="background: {{selectedChallenge.bgColor || '#A0D2F5'}};">
        <image class="modal-npc-avatar" src="{{selectedChallenge.npcAvatar}}" mode="aspectFit"></image>
      </view>

      <!-- ä»»åŠ¡ä¿¡æ¯ -->
      <view class="modal-info">
        <!-- éš¾åº¦æ ‡ç­¾ -->
        <view class="modal-difficulty-tag difficulty-{{selectedChallenge.difficulty}}">
          {{selectedChallenge.difficultyText}}
        </view>

        <!-- ä»»åŠ¡æ ‡é¢˜ -->
        <text class="modal-title">{{selectedChallenge.title}}</text>

        <!-- è§’è‰²ä¿¡æ¯ -->
        <view class="modal-role-section">
          <text class="modal-role-label">YOU ARE PLAYING</text>
          <view class="modal-role-card">
            <text class="modal-role-name">{{selectedChallenge.playerRole}}</text>
            <text class="modal-opponent">Opponent: {{selectedChallenge.opponentRole}}</text>
          </view>
        </view>

        <!-- ä»»åŠ¡ç›®æ ‡ -->
        <view class="modal-objectives">
          <view class="modal-objectives-header">
            <text>ðŸŽ¯</text>
            <text>ä»»åŠ¡ç›®æ ‡</text>
          </view>

          <view class="modal-objective-item" wx:for="{{selectedChallenge.objectives}}" wx:key="id">
            <view class="modal-objective-number">{{index + 1}}</view>
            <text class="modal-objective-text">{{item.description}}</text>
          </view>
        </view>
      </view>

      <!-- å¼€å§‹æŒ‰é’® -->
      <view class="modal-start-btn" bindtap="onStartMission">
        <text>START MISSION</text>
        <text class="play-icon">â–¶</text>
      </view>
    </view>
  </view>
</view>
