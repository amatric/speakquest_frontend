<!-- pages/conversation/conversation.wxml -->
<view class="conversation-page">
  <!-- È°∂ÈÉ®ÂØºËà™ -->
  <view class="nav-header">
    <view class="back-btn" bindtap="onBack">
      <text class="back-arrow">‚Üê</text>
    </view>
    
    <view class="progress-section">
      <text class="progress-label">TASK PROGRESS</text>
      <text class="progress-value">{{completedCount}}/{{totalCount}}</text>
    </view>

    <view class="npc-mini-avatar">
      <image src="{{npcAvatar}}" mode="aspectFill"></image>
    </view>
  </view>

  <!-- ËøõÂ∫¶Êù° -->
  <view class="progress-bar-container">
    <view class="progress-bar">
      <view 
        class="progress-item {{index < completedCount ? 'completed' : ''}}" 
        wx:for="{{objectives}}" 
        wx:key="id"
      ></view>
    </view>
    <text class="current-objective">Current: {{currentObjective}}</text>
  </view>

  <!-- ÂØπËØùÂå∫Âüü -->
  <scroll-view 
    class="chat-area" 
    scroll-y="true" 
    scroll-into-view="{{scrollToId}}"
    scroll-with-animation="true"
  >
    <view class="message-list">
      <view 
        class="message {{item.isUser ? 'user-message' : 'npc-message'}}"
        wx:for="{{messages}}"
        wx:key="id"
        id="msg-{{item.id}}"
      >
        <view class="message-bubble">
          <text>{{item.content}}</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- Â∫ïÈÉ®Â∑•ÂÖ∑Ê†è -->
  <view class="bottom-toolbar">
    <!-- ËæÖÂä©ÊåâÈíÆ -->
    <view class="helper-buttons">
      <view class="helper-btn hint-btn" bindtap="onHint">
        <image src="/images/icons/hint.png" mode="aspectFit"></image>
        <text>HINT</text>
      </view>
      <view class="helper-btn translate-btn" bindtap="onTranslate">
        <image src="/images/icons/translate.png" mode="aspectFit"></image>
        <text>TRANSLATE</text>
      </view>
    </view>

    <!-- ÂΩïÈü≥ÊåâÈíÆ -->
    <view 
      class="record-btn {{isRecording ? 'recording' : ''}}"
      bindtouchstart="onRecordStart"
      bindtouchend="onRecordEnd"
      bindtouchcancel="onRecordEnd"
    >
      <image src="/images/icons/mic.png" mode="aspectFit"></image>
      <text>{{isRecording ? 'RELEASE TO SEND' : 'HOLD TO TALK'}}</text>
    </view>
  </view>

  <!-- ÊèêÁ§∫ÂºπÁ™ó -->
  <view class="hint-modal" wx:if="{{showHint}}">
    <view class="hint-overlay" bindtap="closeHint"></view>
    <view class="hint-content">
      <text class="hint-title">üí° Hint</text>
      <text class="hint-text">{{hintText}}</text>
      <view class="hint-close" bindtap="closeHint">Got it</view>
    </view>
  </view>

  <!-- ÁøªËØëÂºπÁ™ó -->
  <view class="translate-modal" wx:if="{{showTranslate}}">
    <view class="translate-overlay" bindtap="closeTranslate"></view>
    <view class="translate-content">
      <text class="translate-title">üåê Translation</text>
      <text class="translate-original">{{translateOriginal}}</text>
      <text class="translate-result">{{translateResult}}</text>
      <view class="translate-close" bindtap="closeTranslate">Got it</view>
    </view>
  </view>

  <!-- ‰ªªÂä°ÂÆåÊàêÁªìÁÆóÁïåÈù¢ -->
  <view class="result-page" wx:if="{{showComplete}}">
    <!-- ËøîÂõûÊåâÈíÆ -->
    <view class="result-back" bindtap="onCompleteConfirm">
      <text class="back-arrow">‚Üê</text>
    </view>

    <!-- Â•ñÊùØÂå∫Âüü -->
    <view class="trophy-section">
      <view class="trophy-circle">
        <image src="/images/icons/trophy.png" mode="aspectFit" class="trophy-icon"></image>
      </view>
      <text class="result-rating">{{resultData.rating}}</text>
      <view class="stars-row">
        <text class="star" wx:for="{{resultData.stars}}" wx:key="index">‚≠ê</text>
      </view>
      <view class="feedback-tag">
        <text>{{resultData.feedback}}</text>
      </view>
    </view>

    <!-- VOCAB BOOST -->
    <view class="vocab-section">
      <view class="section-header">
        <view class="section-icon vocab-icon">üìñ</view>
        <text class="section-title">VOCAB BOOST</text>
      </view>
      <view class="vocab-card">
        <view class="vocab-item" wx:for="{{resultData.vocabBoost}}" wx:key="word">
          <text class="vocab-word">{{item.word}}</text>
          <text class="vocab-type">{{item.type}}</text>
        </view>
      </view>
    </view>

    <!-- KEY PHRASE -->
    <view class="phrase-section">
      <view class="section-header">
        <view class="section-icon phrase-icon">üí¨</view>
        <text class="section-title">KEY PHRASE</text>
      </view>
      <view class="phrase-card">
        <text class="phrase-text">{{resultData.keyPhrase}}</text>
      </view>
    </view>

    <!-- CONTINUE ÊåâÈíÆ -->
    <view class="continue-btn" bindtap="onCompleteConfirm">
      <text>CONTINUE</text>
    </view>
  </view>
</view>
